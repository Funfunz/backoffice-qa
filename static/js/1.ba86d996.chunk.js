(this.webpackJsonpbackoffice=this.webpackJsonpbackoffice||[]).push([[1],{100:function(e,t,n){e.exports={fieldContainer:"style_fieldContainer__kOYHM",label:"style_label__1Gb-6",field:"style_field__2HVUU"}},117:function(e,t,n){e.exports={toggleField:"style_toggleField__2lQQh",toggleIndicator:"style_toggleIndicator__3-TNJ"}},66:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(0),i=n(16),a=n(83);function o(e){return Object(i.b)("entities/".concat(e)),Object(r.useEffect)((function(){(function(e){return e&&!a.a.getEntity(e)&&!a.a.isLoading(e)&&!a.a.isError(e)})(e)&&a.a.fetchEntity(e).then((function(){Object(i.a)("entities/".concat(e))}))}),[e]),e?a.a.getEntity(e):void 0}},68:function(e,t,n){"use strict";n.d(t,"d",(function(){return d})),n.d(t,"e",(function(){return v})),n.d(t,"c",(function(){return y})),n.d(t,"b",(function(){return b})),n.d(t,"a",(function(){return m}));var r=n(14),i=n.n(r),a=n(11),o=n(67),l=n(4),c=n(22),u=n(83),s=n(18);function d(e,t,n){return f.apply(this,arguments)}function f(){return(f=Object(c.a)(i.a.mark((function e(t,n,r){var l,c,d;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([].concat(Object(o.a)(t.getMnRelations()),Object(o.a)(t.get1nRelations())).map((function(e){return u.a.fetchEntity(e)})));case 2:if(l=e.sent,r=r||[].concat(Object(o.a)(t.getProperties("edit")),Object(o.a)(l.map((function(e){return Object(a.a)({},e.getName(),e.getProperties("relation"))})))),n){e.next=7;break}return c={},e.abrupt("return",Promise.resolve(c));case 7:return d={operation:t.getName(),fields:r.length?r:Object.keys(n),args:{filter:{}}},Object.keys(n).forEach((function(e){d.args.filter[e]={_eq:n[e]}})),e.abrupt("return",s.a.query(d).then((function(e){if(e)return e&&e[0]})).then((function(e){return l.forEach((function(t){e[t.getName()]=e[t.getName()].map((function(e){return e[t.getPk()]}))})),e})));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e,t,n){return p.apply(this,arguments)}function p(){return(p=Object(c.a)(i.a.mark((function e(t,n,r){var c,d,f,v,p;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n&&Object.keys(n).length){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:return c=t.getName(),e.next=5,Promise.all(t.getMnRelations().map((function(e){return u.a.fetchEntity(e)})));case 5:return d=e.sent,f=[].concat(Object(o.a)(t.getProperties("edit")),Object(o.a)(d.map((function(e){return Object(a.a)({},e.getName(),e.getProperties("relation"))})))),v={operation:c[0].toUpperCase()+c.substr(1),args:{data:n},fields:f},r&&v.args?(v.operation="update"+v.operation,v.args.filter=Object.keys(r).reduce((function(e,t){return Object(l.a)(Object(l.a)({},e),{},Object(a.a)({},t,{_eq:r[t]}))}),{}),(null===(p=v.fields)||void 0===p?void 0:p.length)&&(v.fields=Object.keys(r))):v.operation="add"+v.operation,e.abrupt("return",s.a.mutation(v).then((function(e){return Array.isArray(e)?e[0]:e})));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e,t){return void 0===e&&void 0===t||(!(t||!e||Object.keys(e).length)||e&&t&&Object.keys(t).reduce((function(n,r){return n&&e[r]==t[r]}),!0))}function b(e,t){return void 0===e&&void 0===t||(!(t||!e||Object.keys(e).length)||(e&&t&&Object.keys(Object(l.a)(Object(l.a)({},t),e)).reduce((function(n,r){return"object"===typeof e[r]||"object"===typeof t[r]?n&&b(e[r],t[r]):Array.isArray(e[r])||Array.isArray(t[r])?n&&e[r].length===(null===(i=t[r])||void 0===i?void 0:i.length):n&&e[r]==t[r];var i}),!0)||!1))}function m(e,t){if("string"===typeof t||"number"===typeof e||"number"===typeof t||"boolean"===typeof e||"boolean"===typeof t)return e!==t?t:void 0;if(!Array.isArray(e)&&!Array.isArray(t)){var n={};return Object.keys(Object(l.a)(Object(l.a)({},e),t)).forEach((function(r){var i=m(e[r],t[r]);void 0!==i&&(n[r]=i)})),n}for(var r=0;r<Math.max((null===e||void 0===e?void 0:e.length)||0,(null===t||void 0===t?void 0:t.length)||0);r++)if((null===e||void 0===e?void 0:e[r])!==(null===t||void 0===t?void 0:t[r]))return t}},74:function(e,t,n){"use strict";n.d(t,"a",(function(){return U}));var r=n(4),i=n(67),a=n(11),o=n(1),l=n(0),c=n(21),u=n.n(c),s=n(95),d=n.n(s),f=(n(98),n(99),n(77)),v=n.n(f),p=n(100),y=n.n(p),b=function(e){var t=e.name,n=e.label,r=e.children;return Object(o.jsxs)("div",{className:y.a.fieldContainer,children:[n&&Object(o.jsx)("label",{htmlFor:"field-".concat(t),className:y.a.label,children:n}),Object(o.jsx)("div",{className:y.a.field,children:r})]})},m=Object(l.memo)(b),g=function(e){var t,n=e.name,r=e.type,i=void 0===r?"datetime":r,c=e.label,s=e.value,f=e.onChange,p=e.readOnly,y=void 0!==p&&p,b=e.dateFormat,g=void 0===b?"time"!==i&&"YYYY/MM/DD":b,j=e.timeFormat,O=void 0===j?"date"!==i&&"HH:mm":j,h=e.placeholder,k=void 0===h?"".concat(g||""," ").concat(O||""):h,P=Object(l.useCallback)((function(e){if(f){try{e=new Date(e).toISOString().substring(0,10)}catch(t){}f(n,e)}}),[f,n]);return Object(o.jsx)(m,{name:n,label:c,children:Object(o.jsx)(d.a,{value:new Date(s),onChange:P,dateFormat:g,timeFormat:O,open:!0!==y&&void 0,inputProps:{className:u()((t={},Object(a.a)(t,v.a.input,!0),Object(a.a)(t,v.a.readOnly,y),t)),placeholder:k,readOnly:y}})})},j=Object(l.memo)(g),O=function(e){var t,n=e.name,r=e.type,i=void 0===r?"text":r,c=e.label,s=e.value,d=e.placeholder,f=e.onChange,p=e.readOnly,y=void 0!==p&&p,b=Object(l.useCallback)((function(e){if(f){var t=e.target.value;t=void 0!==t&&""!==t?"number"===i?Number(t):t:void 0,f(n,t)}}),[n,f,i]);return Object(o.jsx)(m,{name:n,label:c,children:Object(o.jsx)("input",{className:u()((t={},Object(a.a)(t,v.a.input,!0),Object(a.a)(t,v.a.readOnly,y),t)),id:"field-".concat(n),readOnly:y,name:n,type:i,value:s,placeholder:d,onChange:b})})},h=Object(l.memo)(O),k=n(120),P=function(e){var t=e.name,n=e.label,r=e.placeholder,i=e.value,a=e.onChange,c=e.options,u=void 0===c?[]:c,s=e.readOnly,d=e.onSearch,f=e.isMulti,v=void 0!==f&&f,p=Object(l.useCallback)((function(e){if(a){var n,r="number"===typeof(null===(n=u[0])||void 0===n?void 0:n.value)?Array.isArray(e)?e.map((function(e){return Number(e.value)})):e&&Number(e.value):Array.isArray(e)?e.map((function(e){return e.value})):null===e||void 0===e?void 0:e.value;a(t,null===r&&v?[]:r)}}),[t,a,u,v]),y=Object(l.useCallback)((function(e,t){d&&d(e)}),[d]);return Object(o.jsx)(m,{name:t,label:n,children:Object(o.jsx)(k.a,{onInputChange:y,onChange:p,placeholder:r,name:t,isMulti:v,value:v?u.filter((function(e){return i.includes(e.value)})):u.find((function(e){return e.value===i})),isDisabled:s,options:u.map((function(e){return{label:e.label||e.value,value:e.value}}))})})},x=Object(l.memo)(P),C=n(81),_=n.n(C);var N=function(e){var t=e.url,n=void 0===t?"":t;switch(e.fileType||function(e){var t;switch(null===(t=e.split(".").pop())||void 0===t?void 0:t.toLowerCase()){case"jpg":case"jpeg":case"png":case"gif":return"image"}}(n)){case"image":return Object(o.jsx)("img",{className:_.a.renderImage,alt:"preview",src:n});default:return Object(o.jsx)("div",{children:n})}},E=Object(l.memo)(N),w=function(e){var t,n=e.name,r=e.label,i=e.placeholder,c=e.value,s=e.onChange,d=e.readOnly,f=void 0!==d&&d,v=Object(l.useCallback)((function(e){var t,r;s&&s(n,null===(t=e.target)||void 0===t||null===(r=t.files)||void 0===r?void 0:r[0])}),[n,s]);return Object(o.jsx)(m,{name:n,label:r,children:f?Object(o.jsx)(E,{url:c}):Object(o.jsx)("input",{className:u()((t={},Object(a.a)(t,_.a.input,!0),Object(a.a)(t,_.a.readOnly,f),t)),id:"field-".concat(n),name:n,type:"file",placeholder:i,onChange:v})})},A=Object(l.memo)(w),R=n(12),F=n(66),M=n(82),T=function(e){var t="m:n"===e.type||"n:m"===e.type||"1:n"===e.type,n=Object(l.useState)(),c=Object(R.a)(n,2),u=c[0],s=c[1],d=Object(l.useCallback)((function(e){s(e)}),[]),f=Object(F.a)(e.relationEntityName),v=Object(M.a)({entity:f,view:"relation",search:u}).entries,p=(null===f||void 0===f?void 0:f.getPk())||"id",y=(null===f||void 0===f?void 0:f.getPropertyToBeUsedAsLabel())||"name",b=e.value?Object(a.a)({},p,t?{_in:e.value}:e.value):{},m=Object(M.a)({entity:f,view:"relation",filter:b,request:Object.keys(b).length>0,take:0}).entries,g=[].concat(Object(i.a)(v),Object(i.a)(m)).filter((function(e,t,n){return e[p]&&t===n.findIndex((function(t){return t[p]===e[p]}))}));return Object(o.jsx)(x,Object(r.a)({onSearch:d,isMulti:t,options:g.map((function(e){return{label:e[y],value:e[p]}}))},e))},B=Object(l.memo)(T),S=n(117),q=n.n(S),I=function(e){var t=e.name,n=e.label,r=e.value,i=e.onChange,a=(e.readOnly,Object(l.useCallback)((function(e){if(i){var n=e.target.checked;i(t,n)}}),[t,i])),c=Object(l.useCallback)((function(){i&&i(t,!r)}),[i,r,t]);return Object(o.jsx)(m,{name:t,label:n,children:Object(o.jsxs)("div",{className:q.a.toggleField,onClick:c,children:[Object(o.jsx)("input",{type:"checkbox",id:"field-".concat(t),name:t,onChange:a,checked:!!r}),Object(o.jsx)("div",{className:q.a.toggleIndicator})]})})},L=Object(l.memo)(I);function U(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"view";return e?[].concat(Object(i.a)(e.getProperties(t)),Object(i.a)(e.getMnRelations()),Object(i.a)(e.get1nRelations())).map((function(t){var n=Object(r.a)({name:t,label:e.getPropertyLabel(t),readOnly:e.isPropertyReadOnly(t),type:e.getPropertyEditFieldType(t)||e.getPropertyRelationType(t)||e.getPropertyModelType(t)||"text"},e.getPropertyEditField(t));switch(n.type){case"boolean":case"toggle":return{Component:L,props:n};case"1:n":return console.log("1:n",t,n),{Component:B,props:Object(r.a)({relationType:n.type,relationEntityName:t},n)};case"n:1":case"n:m":case"m:n":return{Component:B,props:Object(r.a)({relationType:n.type,relationEntityName:e.getPropertyRelationEntityName(t)},n)};case"select":return{Component:x,props:n};case"file":return{Component:A,props:n};case"date":case"datetime":case"time":return{Component:j,props:n};case"text":case"number":case"password":default:return{Component:h,props:n}}})):[]}},77:function(e,t,n){e.exports={input:"style_input__w9gXB",readOnly:"style_readOnly__1h-3l"}},81:function(e,t,n){e.exports={input:"style_input__t-6VG",readOnly:"style_readOnly__17g9J",renderImage:"style_renderImage__x3vv6"}},82:function(e,t,n){"use strict";n.d(t,"a",(function(){return f}));var r=n(4),i=n(11),a=n(12),o=n(0),l=n(18);function c(e,t,n){var r={};return Object.keys(t).filter((function(e){return t[e]})).forEach((function(e){var n=t[e];"string"===typeof n?r[e]={_like:"%".concat(n,"%")}:Array.isArray(n)?r[e]={_in:n}:r[e]="number"===typeof n||"boolean"===typeof n?{_eq:n}:n})),n&&(r[e.getPropertyToBeUsedAsLabel()]={_like:"%".concat(n,"%")}),r}function u(e){var t=e.entity,n=e.filter,r=void 0===n?{}:n,i=e.search,a={operation:t.getName()+"Count",args:{filter:c(t,r,i)}};return l.a.query(a).then((function(e){if(e)return e}))}function s(e){var t=e.entity,n=e.filter,r=void 0===n?{}:n,i=e.view,a=void 0===i?"list":i,o=e.take,u=void 0===o?10:o,s=e.skip,d=void 0===s?0:s,f=e.search,v=e.fields,p={operation:t.getName(),fields:v||t.getProperties(a)||Object.keys(r),args:{filter:c(t,r,f),take:u,skip:d}};return l.a.query(p).then((function(e){if(e)return e}))}var d=n(68);function f(e){var t=e.entity,n=e.filter,f=void 0===n?{}:n,v=e.view,p=void 0===v?"list":v,y=e.skip,b=void 0===y?0:y,m=e.take,g=void 0===m?10:m,j=e.request,O=void 0===j||j,h=e.search,k=e.fields,P=Object(o.useState)([]),x=Object(a.a)(P,2),C=x[0],_=x[1],N=Object(o.useState)(0),E=Object(a.a)(N,2),w=E[0],A=E[1],R=Object(o.useState)(!1),F=Object(a.a)(R,2),M=F[0],T=F[1],B=Object(o.useState)(!1),S=Object(a.a)(B,2),q=S[0],I=S[1],L=Object(o.useState)({}),U=Object(a.a)(L,2),D=U[0],Y=U[1],H=Object(o.useCallback)((function(){if(t&&O)return T(!0),Promise.all([s({entity:t,filter:f,skip:b,take:g,view:p,search:h,fields:k}),u({entity:t,filter:f})]).then((function(e){var t=Object(a.a)(e,2),n=t[0],r=t[1];T(!1),n?(_(n),A(r)):I(!0)})).catch((function(){T(!1),I(!0)}))}),[t,f,b,p,g,O,h,k]),J=Object(o.useCallback)((function(e){if(t)return function(e,t){var n=e.getName(),r={operation:"delete".concat(n[0].toUpperCase()+n.substr(1)),args:{filter:c(e,t)},fields:["deleted"]};return l.a.mutation(r).then((function(e){if(e)return e}))}(t,Object(i.a)({},(null===t||void 0===t?void 0:t.getPk())||"id",e)).then(H)}),[t,H]),G=Object(o.useCallback)((function(){return((null===t||void 0===t?void 0:t.getName())!==D.entity||!Object(d.b)(D.filter,f)||b!==D.skip||g!==D.take||(h||"")!==(D.search||""))&&(Y({entity:null===t||void 0===t?void 0:t.getName(),filter:Object(r.a)({},f),skip:b,take:g}),!0)}),[t,D,f,b,g,h]);return Object(o.useEffect)((function(){!G()||M||q||H()}),[M,q,G,H,f,O]),{entries:C,error:q,loading:M,total:w,deleteEntry:J,reload:H}}},83:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(14),i=n.n(r),a=n(22),o=n(29),l=n(36),c=n(18),u=n(91);var s=function(){function e(t){Object(o.a)(this,e),this.entity=void 0,this.entity=t}return Object(l.a)(e,[{key:"getName",value:function(){return this.entity.name}},{key:"getPk",value:function(){var e,t;return(null===(e=this.entity.properties)||void 0===e||null===(t=e.find((function(e){return e.isPk})))||void 0===t?void 0:t.name)||"id"}},{key:"getLabel",value:function(){var e;return(null===(e=this.entity.backoffice)||void 0===e?void 0:e.label)||this.entity.name}},{key:"getProperties",value:function(){var e,t,n=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"list";return"all"===r?(null===(t=this.entity.properties)||void 0===t?void 0:t.map((function(e){return e.name})))||[]:(null===(e=this.entity.properties)||void 0===e?void 0:e.filter((function(e){var t,i,a,o,l,c,u,s,d,f;switch(r){case"relation":return e.isPk||!1!==(null===(t=e.backoffice)||void 0===t||null===(i=t.visible)||void 0===i?void 0:i.relation);case"view":return e.isPk||!1!==(null===(a=e.backoffice)||void 0===a||null===(o=a.visible)||void 0===o?void 0:o.detail);case"new":case"edit":return!n.isPropertyReadOnly(e.name)||void 0===(null===(l=e.backoffice)||void 0===l||null===(c=l.visible)||void 0===c?void 0:c.detail)||(null===(u=e.backoffice)||void 0===u||null===(s=u.visible)||void 0===s?void 0:s.detail);case"list":case"filter":default:return!1!==(null===(d=e.backoffice)||void 0===d||null===(f=d.visible)||void 0===f?void 0:f.entityPage)}})).map((function(e){return e.name})))||[]}},{key:"getMnRelations",value:function(){var e;return(null===(e=this.entity.relations)||void 0===e?void 0:e.filter((function(e){return"m:n"===e.type||"n:m"===e.type})).map((function(e){return e.remoteEntity})))||[]}},{key:"get1nRelations",value:function(){var e;return(null===(e=this.entity.relations)||void 0===e?void 0:e.filter((function(e){return"1:n"===e.type})).map((function(e){return e.remoteEntity})))||[]}},{key:"getPropertyToBeUsedAsLabel",value:function(){var e,t,n;return(null===(e=this.entity.properties)||void 0===e||null===(t=e.find((function(e){var t,n;return null===(t=e.backoffice)||void 0===t||null===(n=t.visible)||void 0===n?void 0:n.relation})))||void 0===t?void 0:t.name)||(null===(n=this.getPropertyByName("name"))||void 0===n?void 0:n.name)||this.getPk()}},{key:"getPropertyByName",value:function(e){var t;return null===(t=this.entity.properties)||void 0===t?void 0:t.find((function(t){return t.name===e}))}},{key:"isPropertyReadOnly",value:function(e){var t=this.getPropertyByName(e);return this.getPk()===e||(null===t||void 0===t?void 0:t.readOnly)}},{key:"getPropertyModelType",value:function(e){var t=this.getPropertyByName(e);return(null===t||void 0===t?void 0:t.type)||"text"}},{key:"getPropertyRelation",value:function(e){var t;return null===(t=this.entity.relations)||void 0===t?void 0:t.find((function(t){return t.foreignKey===e||t.remoteEntity===e}))}},{key:"getPropertyRelationType",value:function(e){var t=this.getPropertyRelation(e);return null===t||void 0===t?void 0:t.type}},{key:"getPropertyRelationEntityName",value:function(e){var t=this.getPropertyRelation(e);return null===t||void 0===t?void 0:t.remoteEntity}},{key:"getPropertyEditField",value:function(e){var t,n=this.getPropertyByName(e);return(null===n||void 0===n||null===(t=n.backoffice)||void 0===t?void 0:t.editField)||{}}},{key:"getPropertyEditFieldType",value:function(e){return this.getPropertyEditField(e).type}},{key:"getPropertyLabel",value:function(e){var t,n=this.getPropertyByName(e);return(null===n||void 0===n||null===(t=n.backoffice)||void 0===t?void 0:t.label)||function(e){var t,n="",r=Object(u.a)(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;i.toUpperCase()===i?n+=" ".concat(i):n+=""===n?i.toUpperCase():i}}catch(a){r.e(a)}finally{r.f()}return n}((null===n||void 0===n?void 0:n.name)||e)}}],[{key:"isError",value:function(t){return!!e.errors[t]}},{key:"isLoading",value:function(t){return e.loading[t]||!1}},{key:"getEntity",value:function(t){return e.entities[t]}},{key:"fetchEntity",value:function(){var t=Object(a.a)(i.a.mark((function t(n){var r;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.entities[n]){t.next=2;break}return t.abrupt("return",e.entities[n]);case 2:return e.loading[n]=!0,t.next=5,c.a.query({operation:"config",fields:[n]});case 5:if(!(r=t.sent)[n]){t.next=13;break}return e.entities[n]=new e(r[n]),e.loading[n]=!1,e.errors[n]=!1,t.abrupt("return",e.entities[n]);case 13:throw e.loading[n]=!1,e.errors[n]=!0,new Error("Entity ".concat(n," not found"));case 16:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}]),e}();s.entities={},s.loading={},s.errors={}},99:function(e,t,n){}}]);
//# sourceMappingURL=1.ba86d996.chunk.js.map